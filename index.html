<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3rabiano - AI Tool</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>
    <!-- Monaco Editor CDN -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.33.0/min/vs/editor/editor.main.css">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #131314; color: #e3e3e3; }
        .main-container { display: flex; height: 100vh; }
        .sidebar { width: 250px; background-color: #1e1f20; padding: 20px; display: flex; flex-direction: column; justify-content: space-between; }
        .content-area { flex-grow: 1; padding: 20px 40px; display: flex; flex-direction: column; height: 100vh; overflow-y: auto; }
        .chat-input-container { position: sticky; bottom: 0; padding: 20px 0; background-color: #131314; }
        .chat-input { background-color: #1e1f20; border: 1px solid #333; border-radius: 50px; padding: 15px 25px; color: #e3e3e3; width: 100%; }
        .menu-item { display: flex; align-items: center; padding: 10px; border-radius: 8px; cursor: pointer; transition: background-color 0.2s; }
        .menu-item:hover, .menu-item.active { background-color: #282a2b; }
        .menu-item i { margin-right: 15px; width: 20px; text-align: center; }
        .chat-message { padding: 15px; border-radius: 12px; margin-bottom: 15px; max-width: 80%; display: flex; align-items: flex-start; }
        .user-message { background-color: #282a2b; align-self: flex-end; margin-left: auto; }
        .ai-message { background-color: #1e1f20; align-self: flex-start; }
        .avatar { width: 32px; height: 32px; border-radius: 50%; margin-right: 15px; display: flex; align-items: center; justify-content: center; font-weight: bold; flex-shrink: 0; background-size: cover; background-position: center; }
        .user-avatar { background-color: #4a4a4a; }
        .ai-avatar { background: linear-gradient(135deg, #4285F4 0%, #34A853 100%); }
        .chess-board { width: 400px; height: 400px; display: grid; grid-template-columns: repeat(8, 1fr); border: 2px solid #333; }
        .chess-square { width: 50px; height: 50px; display: flex; align-items: center; justify-content: center; font-size: 36px; }
        .chess-square.light { background-color: #f0d9b5; }
        .chess-square.dark { background-color: #b58863; }
        .chess-piece { cursor: grab; }
        .hidden { display: none; }
        #voice-mode-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(19, 19, 20, 0.98); z-index: 100; display: flex; flex-direction: column; justify-content: center; align-items: center; }
        #exit-voice-mode-btn { position: absolute; top: 30px; right: 30px; font-size: 24px; cursor: pointer; }
        #voice-mic-circle { width: 150px; height: 150px; border-radius: 50%; background-color: #4285F4; display: flex; justify-content: center; align-items: center; cursor: pointer; transition: transform 0.2s, background-color 0.2s; }
        #voice-mic-circle.listening { background-color: #d9534f; animation: pulse 1.5s infinite; }
        #voice-mic-circle:hover { transform: scale(1.05); }
        #voice-mode-status-text { margin-top: 30px; font-size: 1.2rem; color: #e3e3e3; text-align: center; max-width: 80%; }
        @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(217, 83, 79, 0.7); } 70% { box-shadow: 0 0 0 20px rgba(217, 83, 79, 0); } 100% { box-shadow: 0 0 0 0 rgba(217, 83, 79, 0); } }
        select, input[type=text], input[type=email], input[type=password] { background-color: #282a2b; color: white; padding: 8px; border-radius: 5px; border: 1px solid #333; }
        .code-preview-container { display: flex; gap: 1rem; flex-grow: 1; height: calc(100vh - 250px); }
        .code-history, .code-live-preview { flex: 1; overflow-y: auto; background-color: #1e1f20; border-radius: 8px; }
        #code-preview-iframe { width: 100%; height: 100%; border: none; border-radius: 8px; background-color: white; }
        .code-preview-header { background-color: #282a2b; padding: 8px 12px; border-top-left-radius: 8px; border-top-right-radius: 8px; display: flex; justify-content: space-between; align-items: center; }
        .action-btn { background-color: #4a4a4a; color: white; border: none; padding: 4px 8px; border-radius: 4px; cursor: pointer; }
        .action-btn:hover { background-color: #5a5a5a; }
        #image-gallery { display: grid; grid-template-columns: repeat(auto-fit, minmax(256px, 1fr)); gap: 1rem; }
        .gallery-item { position: relative; }
        .gallery-item img { width: 100%; height: auto; border-radius: 8px; display: block; }
        .gallery-item .gallery-item-overlay { position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); opacity: 0; transition: opacity 0.3s; display: flex; justify-content: center; align-items: center; }
        .gallery-item:hover .gallery-item-overlay { opacity: 1; }
        .feature-panel { background-color: #1e1f20; padding: 1.5rem; border-radius: 0.5rem; }
        .feature-panel-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; }
        .feature-panel h3 { font-size: 1.25rem; font-weight: 600; margin: 0; }
        .feature-panel textarea, .feature-panel input { width: 100%; background-color: #131314; border: 1px solid #333; border-radius: 0.5rem; padding: 0.75rem; color: #e3e3e3; }
        .feature-panel textarea { min-height: 100px; }
        .feature-panel button { background-color: #4285F4; color: white; font-weight: bold; padding: 0.5rem 1rem; border-radius: 0.5rem; width: 100%; margin-top: 1rem; }
        .feature-panel button:hover { background-color: #3367D6; }
        .result-box { margin-top: 1.5rem; background-color: #131314; padding: 1rem; border-radius: 0.5rem; min-height: 100px; white-space: pre-wrap; }
        .tabs { display: flex; flex-wrap: wrap; gap: 0.5rem; margin-bottom: 1.5rem; border-bottom: 1px solid #333; }
        .tab { padding: 0.5rem 1rem; cursor: pointer; border-bottom: 2px solid transparent; }
        .tab.active { border-bottom-color: #4285F4; color: #4285F4; }
        .typing-indicator span { height: 8px; width: 8px; background-color: #9ca3af; border-radius: 50%; display: inline-block; animation: bounce 1.4s infinite ease-in-out both; }
        .typing-indicator span:nth-child(1) { animation-delay: -0.32s; }
        .typing-indicator span:nth-child(2) { animation-delay: -0.16s; }
        @keyframes bounce { 0%, 80%, 100% { transform: scale(0); } 40% { transform: scale(1.0); } }
        .zone-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem; }
        .zone-card { background-color: #1e1f20; border-radius: 0.5rem; padding: 1.5rem; text-align: center; cursor: pointer; transition: transform 0.2s, box-shadow 0.2s; }
        .zone-card:hover { transform: translateY(-5px); box-shadow: 0 10px 20px rgba(0,0,0,0.2); }
        .zone-card i { font-size: 2.5rem; margin-bottom: 1rem; }
        .zone-card h3 { font-size: 1.5rem; font-weight: 600; margin-bottom: 0.5rem; }
        .zone-card p { color: #a0aec0; }
        .zone-detail-header { display: flex; align-items: center; margin-bottom: 1.5rem; }
        .back-to-zones-btn { background: none; border: none; color: #a0aec0; font-size: 1.5rem; cursor: pointer; margin-right: 1rem; }
        .back-to-zones-btn:hover { color: #fff; }
        #islamic-feature[dir="rtl"] .menu-item i { margin-left: 15px; margin-right: 0; }
        .islamic-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem; }
        .islamic-feature-card { background-color: #1e1f20; border-radius: 0.5rem; padding: 1.5rem; }
        .prayer-time { display: flex; justify-content: space-between; padding: 0.5rem 0; border-bottom: 1px solid #333; }
        .prayer-time:last-child { border-bottom: none; }
        #qibla-compass { width: 150px; height: 150px; background-color: #131314; border-radius: 50%; border: 2px solid #333; position: relative; margin: 1rem auto; }
        #qibla-arrow { width: 0; height: 0; border-left: 10px solid transparent; border-right: 10px solid transparent; border-bottom: 60px solid #2ECC71; position: absolute; top: 15px; left: 50%; transform-origin: 50% 60px; transform: translateX(-50%) rotate(135deg); }
        .compass-point { position: absolute; font-weight: bold; color: #a0aec0;}
        .north { top: 5px; left: 50%; transform: translateX(-50%); }
        .south { bottom: 5px; left: 50%; transform: translateX(-50%); }
        .east { top: 50%; right: 5px; transform: translateY(-50%); }
        .west { top: 50%; left: 5px; transform: translateY(-50%); }
        #workplace-container { display: flex; flex-grow: 1; gap: 1rem; }
        #workplace-editor-container { flex: 1; display: flex; flex-direction: column; }
        #workplace-preview-container { flex: 1; display: flex; flex-direction: column; }
        #workplace-editor { flex-grow: 1; border-radius: 8px; overflow: hidden; }
        #workplace-preview { width: 100%; flex-grow: 1; border: none; border-radius: 8px; background-color: white; }
        .workplace-header { background-color: #282a2b; padding: 8px 12px; border-top-left-radius: 8px; border-top-right-radius: 8px; display: flex; justify-content: space-between; align-items: center; }
        
        /* Auth Modal Styling */
        #auth-container { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.8); z-index: 200; display: flex; justify-content: center; align-items: center; }
        .auth-modal { background-color: #1e1f20; padding: 2rem; border-radius: 0.5rem; width: 90%; max-width: 400px; }
        .auth-modal h2 { text-align: center; margin-bottom: 1.5rem; }
        .auth-modal input { width: 100%; margin-bottom: 1rem; }
        .auth-modal button { width: 100%; padding: 0.75rem; border-radius: 0.5rem; border: none; font-weight: bold; cursor: pointer; }
        .auth-modal button.primary { background-color: #4285F4; color: white; }
        .auth-modal button.secondary { background-color: #333; color: white; margin-top: 0.5rem; }
        .auth-modal #auth-error { color: #ef4444; text-align: center; margin-top: 1rem; min-height: 1.5rem; }
        .auth-toggle { text-align: center; margin-top: 1rem; font-size: 0.9rem; }
        .auth-toggle a { color: #4285F4; cursor: pointer; text-decoration: underline; }
    </style>
</head>
<body>
    <!-- Auth Container -->
    <div id="auth-container">
        <div class="auth-modal">
            <!-- Login Form -->
            <div id="login-form">
                <h2 class="text-2xl font-bold">Login to 3rabiano AI</h2>
                <input type="email" id="login-email" placeholder="Email" required>
                <input type="password" id="login-password" placeholder="Password" required>
                <button id="login-btn" class="primary">Login</button>
                <div id="auth-error"></div>
                <p class="auth-toggle">Don't have an account? <a id="show-signup">Sign up</a></p>
            </div>
            <!-- Signup Form -->
            <div id="signup-form" class="hidden">
                <h2 class="text-2xl font-bold">Create Account</h2>
                <input type="email" id="signup-email" placeholder="Email" required>
                <input type="password" id="signup-password" placeholder="Password" required>
                <input type="text" id="signup-fullname" placeholder="Full Name">
                <button id="signup-btn" class="primary">Sign Up</button>
                <div id="auth-error-signup"></div>
                <p class="auth-toggle">Already have an account? <a id="show-login">Login</a></p>
            </div>
        </div>
    </div>

    <!-- Main App Container (hidden by default) -->
    <div id="app-container" class="hidden">
        <!-- Full Screen Voice Mode -->
        <div id="voice-mode-overlay" class="hidden">
            <i id="exit-voice-mode-btn" class="fas fa-times"></i>
            <div id="voice-mic-circle"><i class="fas fa-microphone-alt text-white text-5xl"></i></div>
            <p id="voice-mode-status-text">Tap the circle to speak</p>
        </div>

        <div class="main-container">
            <!-- Sidebar -->
            <div class="sidebar">
                <div>
                    <h1 class="text-2xl font-bold mb-8 text-white">3rabiano AI</h1>
                    <nav>
                        <div class="menu-item active" data-feature="chat"><i class="fas fa-comments"></i><span>Ask Questions</span></div>
                        <div class="menu-item" data-feature="islamic"><i class="fas fa-mosque"></i><span>Islamic Mode</span></div>
                        <div class="menu-item" data-feature="zones"><i class="fas fa-th-large"></i><span>Zones</span></div>
                        <div class="menu-item" data-feature="generations"><i class="fas fa-magic"></i><span>Generations</span></div>
                        <div class="menu-item" data-feature="code"><i class="fas fa-code"></i><span>Code</span></div>
                        <div class="menu-item" data-feature="chess"><i class="fas fa-chess"></i><span>Play Chess</span></div>
                        <div class="menu-item" data-feature="educational"><i class="fas fa-user-graduate"></i><span>Educational</span></div>
                        <div class="menu-item" data-feature="research"><i class="fas fa-search"></i><span>Research</span></div>
                        <div class="menu-item" data-feature="links"><i class="fas fa-link"></i><span>Check Links</span></div>
                    </nav>
                </div>
                <div>
                    <div class="menu-item" data-feature="settings"><i class="fas fa-cog"></i><span>Settings</span></div>
                    <div id="logout-menu-item" class="menu-item"><i class="fas fa-sign-out-alt"></i><span>Logout</span></div>
                </div>
            </div>

            <!-- Main Content -->
            <div class="content-area">
                <!-- Chat Feature -->
                <div id="chat-feature" class="feature-content">
                    <div id="chat-history" class="flex-grow mb-4 flex flex-col">
                        <!-- Messages will be appended here -->
                    </div>
                    <div class="chat-input-container">
                        <div class="relative">
                            <input type="text" id="chat-input" class="chat-input pr-24" placeholder="Ask me anything...">
                            <button id="send-btn" class="absolute right-5 top-1/2 -translate-y-1/2 text-gray-400 hover:text-white"><i class="fas fa-paper-plane"></i></button>
                            <button id="voice-mode-btn" class="absolute right-14 top-1/2 -translate-y-1/2 text-gray-400 hover:text-white"><i class="fas fa-headphones-alt"></i></button>
                        </div>
                    </div>
                </div>

                <!-- Settings Feature -->
                <div id="settings-feature" class="feature-content hidden">
                    <h2 class="text-3xl font-bold mb-6">Profile Settings</h2>
                    <div class="feature-panel">
                        <div class="space-y-4">
                            <div>
                                <label for="profile-username" class="block mb-2 text-sm font-medium">Username</label>
                                <input type="text" id="profile-username" placeholder="Your unique username">
                            </div>
                            <div>
                                <label for="profile-fullname" class="block mb-2 text-sm font-medium">Full Name</label>
                                <input type="text" id="profile-fullname" placeholder="Your full name">
                            </div>
                            <div>
                                <label for="profile-website" class="block mb-2 text-sm font-medium">Website</label>
                                <input type="text" id="profile-website" placeholder="https://your-website.com">
                            </div>
                             <div>
                                <label for="profile-avatar" class="block mb-2 text-sm font-medium">Avatar URL</label>
                                <input type="text" id="profile-avatar" placeholder="https://url-to-your-avatar.png">
                            </div>
                            <button id="update-profile-btn">Update Profile</button>
                            <div id="profile-message" class="text-center text-green-400 mt-4"></div>
                        </div>
                    </div>
                </div>

                <!-- All other features from the original HTML go here, unchanged -->
                <!-- ISLAMIC MODE FEATURE -->
                <div id="islamic-feature" class="feature-content hidden" dir="rtl">
                    <h2 class="text-3xl font-bold mb-2">ÿßŸÑŸàÿ∂ÿπ ÿßŸÑÿ•ÿ≥ŸÑÿßŸÖŸä</h2>
                    <p class="text-lg text-gray-400 mb-8" id="hijri-date-display">Ÿ° ŸÖÿ≠ÿ±ŸÖÿå Ÿ°Ÿ§Ÿ§Ÿß ŸáŸÄ</p>
                    <div class="islamic-grid">
                        <div class="islamic-feature-card col-span-1 md:col-span-2">
                            <div class="feature-panel-header">
                                <h3 class="flex items-center"><i class="fas fa-clock ml-3"></i>ÿ£ŸàŸÇÿßÿ™ ÿßŸÑÿµŸÑÿßÿ©</h3>
                            </div>
                            <p class="text-sm text-gray-500 mb-4">ŸÑŸÖÿØŸäŸÜÿ© ÿØŸÖŸÜŸáŸàÿ±ÿå ŸÖÿµÿ± ÿ®ÿ™ÿßÿ±ŸäÿÆ Ÿ¢Ÿ¶ ŸäŸàŸÑŸäŸà Ÿ¢Ÿ†Ÿ¢Ÿ•</p>
                            <div id="prayer-times-list">
                                <div class="prayer-time"><span>ÿßŸÑŸÅÿ¨ÿ±</span><span>Ÿ§:Ÿ†Ÿ© ÿµ</span></div>
                                <div class="prayer-time"><span>ÿßŸÑÿ∏Ÿáÿ±</span><span>Ÿ°Ÿ¢:Ÿ•Ÿ© ŸÖ</span></div>
                                <div class="prayer-time"><span>ÿßŸÑÿπÿµÿ±</span><span>Ÿ§:Ÿ£Ÿ® ŸÖ</span></div>
                                <div class="prayer-time"><span>ÿßŸÑŸÖÿ∫ÿ±ÿ®</span><span>Ÿß:Ÿ•Ÿ§ ŸÖ</span></div>
                                <div class="prayer-time"><span>ÿßŸÑÿπÿ¥ÿßÿ°</span><span>Ÿ©:Ÿ¢Ÿ¢ ŸÖ</span></div>
                            </div>
                        </div>
                        <div class="islamic-feature-card text-center">
                            <h3 class="flex items-center justify-center"><i class="fas fa-kaaba ml-3"></i>ÿßÿ™ÿ¨ÿßŸá ÿßŸÑŸÇÿ®ŸÑÿ©</h3>
                            <div id="qibla-compass">
                                <div class="compass-point north">ÿ¥</div>
                                <div class="compass-point south">ÿ¨</div>
                                <div class="compass-point east">ŸÇ</div>
                                <div class="compass-point west">ÿ∫</div>
                                <div id="qibla-arrow"></div>
                            </div>
                            <p class="text-sm text-gray-500">ÿßÿ™ÿ¨ÿßŸá ÿ™ŸÇÿ±Ÿäÿ®Ÿä ŸÑŸÖÿØŸäŸÜÿ© ÿØŸÖŸÜŸáŸàÿ±ÿå ŸÖÿµÿ±. ŸÑŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ÿßÿ™ÿ¨ÿßŸá ÿØŸÇŸäŸÇÿå ÿßÿ≥ÿ™ÿÆÿØŸÖ ÿ™ÿ∑ÿ®ŸäŸÇŸãÿß ŸÖÿÆÿµÿµŸãÿß.</p>
                        </div>
                        <div class="islamic-feature-card">
                            <div class="feature-panel-header">
                                <h3 class="flex items-center"><i class="fas fa-quran ml-3"></i>ÿ¢Ÿäÿ© ÿßŸÑŸäŸàŸÖ</h3>
                                <button class="action-btn download-btn" data-target="verse-of-the-day" data-filename="verse.txt"><i class="fas fa-download"></i></button>
                            </div>
                            <div id="verse-of-the-day" class="result-box text-lg italic"></div>
                            <button id="new-verse-btn" class="mt-4 w-full">ÿ¢Ÿäÿ© ÿ¨ÿØŸäÿØÿ©</button>
                        </div>
                        <div class="islamic-feature-card">
                            <div class="feature-panel-header">
                                <h3 class="flex items-center"><i class="fas fa-book-open ml-3"></i>ÿ≠ÿØŸäÿ´ ÿßŸÑŸäŸàŸÖ</h3>
                                <button class="action-btn download-btn" data-target="hadith-of-the-day" data-filename="hadith.txt"><i class="fas fa-download"></i></button>
                            </div>
                            <div id="hadith-of-the-day" class="result-box italic"></div>
                            <button id="new-hadith-btn" class="mt-4 w-full">ÿ≠ÿØŸäÿ´ ÿ¨ÿØŸäÿØ</button>
                        </div>
                        <div class="islamic-feature-card col-span-1 md:col-span-3">
                            <div class="feature-panel-header">
                                <h3 class="flex items-center"><i class="fas fa-question-circle ml-3"></i>ÿ≥ÿ§ÿßŸÑ Ÿàÿ¨Ÿàÿßÿ® ÿ•ÿ≥ŸÑÿßŸÖŸä</h3>
                                <button class="action-btn download-btn hidden" data-target="islamic-qa-result" data-filename="islamic-qa.txt"><i class="fas fa-download"></i></button>
                            </div>
                            <textarea id="islamic-qa-prompt" placeholder="ÿßÿ≥ÿ£ŸÑ ÿ≥ÿ§ÿßŸÑÿßŸã ÿπŸÜ ÿßŸÑÿ•ÿ≥ŸÑÿßŸÖ..."></textarea>
                            <button id="islamic-qa-btn" class="zone-generate-btn" data-prompt-id="islamic-qa-prompt" data-result-id="islamic-qa-result">ÿßÿ≠ÿµŸÑ ÿπŸÑŸâ ÿ•ÿ¨ÿßÿ®ÿ©</button>
                            <div id="islamic-qa-result" class="result-box"></div>
                        </div>
                    </div>
                </div>
                <!-- ZONES FEATURE -->
                <div id="zones-feature" class="feature-content hidden">
                    <div id="zone-selection">
                        <h2 class="text-3xl font-bold mb-6">Welcome to the Zones</h2>
                        <p class="text-lg text-gray-400 mb-8">Select a zone to get started.</p>
                        <div class="zone-grid">
                            <div class="zone-card" data-zone="study"><i class="fas fa-brain text-blue-400"></i><h3>Study Zone</h3><p>A space for learning, focus, and education.</p></div>
                            <div class="zone-card" data-zone="work"><i class="fas fa-briefcase text-green-400"></i><h3>Work Zone</h3><p>A productivity space for professionals.</p></div>
                            <div class="zone-card" data-zone="kitchen"><i class="fas fa-utensils text-orange-400"></i><h3>Kitchen Zone</h3><p>Home, recipes, and cooking help.</p></div>
                            <div class="zone-card" data-zone="fun"><i class="fas fa-gamepad text-purple-400"></i><h3>Fun Zone</h3><p>A relaxing and creative space for entertainment.</p></div>
                            <div class="zone-card" data-zone="mind"><i class="fas fa-spa text-teal-400"></i><h3>Mind Zone</h3><p>For mental health, meditation, and self-care.</p></div>
                            <div class="zone-card" data-zone="developer"><i class="fas fa-laptop-code text-red-400"></i><h3>Developer Zone</h3><p>For coders and technical users.</p></div>
                        </div>
                    </div>
                    <!-- Zone Details -->
                    <div id="study-zone-detail" class="zone-detail hidden"><div class="zone-detail-header"><button class="back-to-zones-btn"><i class="fas fa-arrow-left"></i></button><h2 class="text-3xl font-bold">üß† Study Zone</h2></div><div class="space-y-6"><div class="feature-panel"><div class="feature-panel-header"><h3>AI Tutor</h3><button class="action-btn download-btn hidden" data-target="ai-tutor-result" data-filename="ai-tutor.txt"><i class="fas fa-download"></i></button></div><textarea id="ai-tutor-prompt" placeholder="Ask anything..."></textarea><button data-prompt-id="ai-tutor-prompt" data-result-id="ai-tutor-result" class="zone-generate-btn">Get Answer</button><div id="ai-tutor-result" class="result-box"></div></div><div class="feature-panel"><div class="feature-panel-header"><h3>Notes & Flashcards</h3><button class="action-btn download-btn hidden" data-target="notes-flashcards-result" data-filename="notes.txt"><i class="fas fa-download"></i></button></div><textarea id="notes-flashcards-prompt" placeholder="Paste text..."></textarea><button data-prompt-id="notes-flashcards-prompt" data-result-id="notes-flashcards-result" class="zone-generate-btn">Generate</button><div id="notes-flashcards-result" class="result-box"></div></div></div></div>
                    <div id="work-zone-detail" class="zone-detail hidden"><div class="zone-detail-header"><button class="back-to-zones-btn"><i class="fas fa-arrow-left"></i></button><h2 class="text-3xl font-bold">üíº Work Zone</h2></div><div class="space-y-6"><div class="feature-panel"><div class="feature-panel-header"><h3>AI Resume Writer</h3><button class="action-btn download-btn hidden" data-target="resume-result" data-filename="resume.txt"><i class="fas fa-download"></i></button></div><textarea id="resume-prompt" placeholder="Paste job description..."></textarea><button data-prompt-id="resume-prompt" data-result-id="resume-result" class="zone-generate-btn">Generate</button><div id="resume-result" class="result-box"></div></div><div class="feature-panel"><div class="feature-panel-header"><h3>Email Generator</h3><button class="action-btn download-btn hidden" data-target="email-result" data-filename="email.txt"><i class="fas fa-download"></i></button></div><textarea id="email-prompt" placeholder="Describe the email..."></textarea><button data-prompt-id="email-prompt" data-result-id="email-result" class="zone-generate-btn">Generate Email</button><div id="email-result" class="result-box"></div></div></div></div>
                    <div id="kitchen-zone-detail" class="zone-detail hidden"><div class="zone-detail-header"><button class="back-to-zones-btn"><i class="fas fa-arrow-left"></i></button><h2 class="text-3xl font-bold">üç≥ Kitchen Zone</h2></div><div class="space-y-6"><div class="feature-panel"><div class="feature-panel-header"><h3>Recipe Generator</h3><button class="action-btn download-btn hidden" data-target="recipe-result" data-filename="recipes.txt"><i class="fas fa-download"></i></button></div><textarea id="recipe-prompt" placeholder="List ingredients..."></textarea><button data-prompt-id="recipe-prompt" data-result-id="recipe-result" class="zone-generate-btn">Find Recipes</button><div id="recipe-result" class="result-box"></div></div></div></div>
                    <div id="fun-zone-detail" class="zone-detail hidden"><div class="zone-detail-header"><button class="back-to-zones-btn"><i class="fas fa-arrow-left"></i></button><h2 class="text-3xl font-bold">üéÆ Fun Zone</h2></div><div class="space-y-6"><div class="feature-panel"><div class="feature-panel-header"><h3>AI Joke Generator</h3><button class="action-btn download-btn hidden" data-target="joke-result" data-filename="joke.txt"><i class="fas fa-download"></i></button></div><textarea id="joke-prompt" placeholder="Enter a topic..."></textarea><button data-prompt-id="joke-prompt" data-result-id="joke-result" class="zone-generate-btn">Tell me a Joke</button><div id="joke-result" class="result-box"></div></div></div></div>
                    <div id="mind-zone-detail" class="zone-detail hidden"><div class="zone-detail-header"><button class="back-to-zones-btn"><i class="fas fa-arrow-left"></i></button><h2 class="text-3xl font-bold">üßò Mind Zone</h2></div><div class="space-y-6"><div class="feature-panel"><div class="feature-panel-header"><h3>AI Therapist (Chatbot)</h3><button class="action-btn download-btn hidden" data-target="therapist-result" data-filename="therapist-chat.txt"><i class="fas fa-download"></i></button></div><textarea id="therapist-prompt" placeholder="How are you feeling?"></textarea><button data-prompt-id="therapist-prompt" data-result-id="therapist-result" class="zone-generate-btn">Chat</button><div id="therapist-result" class="result-box"></div></div></div></div>
                    <div id="developer-zone-detail" class="zone-detail hidden"><div class="zone-detail-header"><button class="back-to-zones-btn"><i class="fas fa-arrow-left"></i></button><h2 class="text-3xl font-bold">üë®‚Äçüíª Developer Zone</h2></div><p class="mb-4 text-gray-400">Go to the main 'Code' section for advanced tools.</p><button id="go-to-code-feature" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg">Go to Code Tools</button></div>
                </div>
                <!-- Generations Feature -->
                <div id="generations-feature" class="feature-content hidden">
                    <h2 class="text-3xl font-bold mb-6">Generations</h2>
                    <div class="tabs generation-tabs"><div class="tab generation-tab active" data-gen-tab="photo">Photo</div><div class="tab generation-tab" data-gen-tab="text">Text</div><div class="tab generation-tab" data-gen-tab="qrcode">QR Code</div></div>
                    <div id="photo-gen-tab" class="gen-tab-content"><div class="bg-[#1e1f20] p-6 rounded-lg"><input type="text" id="image-prompt" class="w-full bg-[#131314] border border-gray-600 rounded-lg p-3 mb-4" placeholder="Describe the image..."><button id="generate-image-btn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg w-full">Generate Image</button><div id="image-loading" class="text-center my-4 hidden"><div class="typing-indicator"><span></span><span></span><span></span></div></div><div id="image-gallery" class="mt-6"></div></div></div>
                    <div id="text-gen-tab" class="gen-tab-content hidden"><div class="feature-panel"><div class="feature-panel-header"><h3>Text Generation</h3><button class="action-btn download-btn hidden" data-target="text-gen-result" data-filename="generated-text.txt"><i class="fas fa-download"></i></button></div><select id="text-type-select" class="w-full bg-[#131314] border border-gray-600 rounded-lg p-3 mb-4"><option value="email">Email</option><option value="poem">Poem</option><option value="article">Article</option></select><textarea id="text-gen-prompt" placeholder="Describe..."></textarea><button id="generate-text-btn" class="zone-generate-btn" data-prompt-id="text-gen-prompt" data-result-id="text-gen-result">Generate Text</button><div id="text-gen-result" class="result-box"></div></div></div>
                    <div id="qrcode-gen-tab" class="gen-tab-content hidden"><div class="bg-[#1e1f20] p-6 rounded-lg"><input type="text" id="qrcode-prompt" class="w-full bg-[#131314] border border-gray-600 rounded-lg p-3 mb-4" placeholder="Enter text or URL..."><button id="generate-qrcode-btn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg w-full">Generate QR Code</button><div id="qrcode-output" class="mt-6 p-4 bg-white rounded-lg flex justify-center items-center"></div><button id="download-qrcode-btn" class="mt-4 bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg w-full hidden">Download</button></div></div>
                </div>
                <!-- Code Feature -->
                <div id="code-feature" class="feature-content hidden flex flex-col">
                    <h2 class="text-3xl font-bold mb-6">Code Tools</h2>
                    <div class="tabs code-tabs"><div class="tab code-tab active" data-code-tab="write">Write Code</div><div class="tab code-tab" data-code-tab="workplace">AI Workplace</div></div>
                    <div id="write-code-tab" class="code-tab-content flex flex-col flex-grow"><div class="code-preview-container"><div id="code-history" class="code-history p-4"></div><div class="code-live-preview"><div class="code-preview-header"><span>Live Preview</span><button class="action-btn" id="download-code-btn"><i class="fas fa-download"></i> Download</button></div><iframe id="code-preview-iframe"></iframe></div></div><div class="chat-input-container"><input type="text" id="code-input" class="chat-input" placeholder="Describe code..."></div></div>
                    <div id="workplace-code-tab" class="code-tab-content hidden flex-grow flex flex-col"><div id="workplace-container"><div id="workplace-editor-container"><div class="workplace-header"><span>Code Editor</span><button id="workplace-help-btn" class="action-btn"><i class="fas fa-magic"></i> Ask AI</button></div><div id="workplace-editor"></div></div><div id="workplace-preview-container"><div class="workplace-header"><span>Live Preview</span></div><iframe id="workplace-preview"></iframe></div></div><div id="workplace-result" class="result-box hidden"></div></div>
                </div>
                <!-- Chess Game Feature -->
                <div id="chess-feature" class="feature-content hidden flex flex-col items-center justify-center">
                    <h2 class="text-3xl font-bold mb-6">Play Chess</h2>
                    <div class="flex items-center mb-4"><label for="chess-difficulty" class="mr-4">AI Level:</label><select id="chess-difficulty"><option value="1">Easy</option><option value="2">Medium</option><option value="3">Hard</option></select></div>
                    <div id="chess-board" class="chess-board"></div>
                    <div id="chess-status" class="mt-4 text-lg">Select difficulty to start</div>
                    <button id="reset-chess-btn" class="mt-4 bg-gray-600 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded-lg">New Game</button>
                </div>
                <!-- Educational Feature -->
                <div id="educational-feature" class="feature-content hidden">
                    <h2 class="text-3xl font-bold mb-6">Educational Tools</h2>
                    <div class="space-y-6"><div class="feature-panel"><div class="feature-panel-header"><h3>Math Problem Solver</h3><button class="action-btn download-btn hidden" data-target="math-result" data-filename="math-solution.txt"><i class="fas fa-download"></i></button></div><textarea id="math-prompt" placeholder="e.g., 2x + 5 = 15"></textarea><button id="solve-math-btn">Solve Problem</button><div id="math-result" class="result-box"></div></div></div>
                </div>
                <!-- Research Feature -->
                <div id="research-feature" class="feature-content hidden">
                    <h2 class="text-3xl font-bold mb-6">Research Assistant</h2>
                    <div class="feature-panel"><div class="feature-panel-header"><h3>Search & Summarize</h3><button class="action-btn download-btn hidden" data-target="research-result" data-filename="research.txt"><i class="fas fa-download"></i></button></div><textarea id="research-prompt" placeholder="Enter a topic..."></textarea><button id="research-btn">Start Research</button><div id="research-result" class="result-box"></div></div>
                </div>
                <!-- Check Links Feature -->
                <div id="links-feature" class="feature-content hidden">
                    <h2 class="text-3xl font-bold mb-6">Link Security Checker</h2>
                    <div class="feature-panel"><div class="feature-panel-header"><h3>Check a URL</h3><button class="action-btn download-btn hidden" data-target="link-result" data-filename="link-analysis.txt"><i class="fas fa-download"></i></button></div><input type="text" id="link-prompt" placeholder="Enter a URL..."><button id="check-link-btn">Check Link</button><div id="link-result" class="result-box"></div></div>
                </div>
            </div>
        </div>
    </div>
    
    <script type="module">
        // Import Supabase client
        import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';

        // --- SUPABASE SETUP ---
        const SUPABASE_URL = 'https://yurtisxjcqjvbpobbogo.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inl1cnRpc3hqY3FqdmJwb2Jib2dvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTM0NDI4MTIsImV4cCI6MjA2OTAxODgxMn0.R-jT8BeicNNCPfVE0iH5911ua3VdCKTX3vOBmr1mQC0';

        if (SUPABASE_URL === 'YOUR_SUPABASE_URL' || SUPABASE_ANON_KEY === 'YOUR_SUPABASE_ANON_KEY') {
            document.body.innerHTML = `<div style="display:flex; justify-content:center; align-items:center; height:100vh; text-align:center; color:white; font-size:1.2rem;">Please update the SUPABASE_URL and SUPABASE_ANON_KEY in the script.</div>`;
        }

        const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        // --- GLOBAL STATE & UI ELEMENTS ---
        const authContainer = document.getElementById('auth-container');
        const appContainer = document.getElementById('app-container');
        let currentUser = null;
        let userProfile = null;
        let chatHistorySubscription = null;

        // --- AUTHENTICATION ---
        const loginForm = document.getElementById('login-form');
        const signupForm = document.getElementById('signup-form');
        const showSignupBtn = document.getElementById('show-signup');
        const showLoginBtn = document.getElementById('show-login');
        const loginBtn = document.getElementById('login-btn');
        const signupBtn = document.getElementById('signup-btn');
        const logoutBtn = document.getElementById('logout-menu-item');
        const authErrorDiv = document.getElementById('auth-error');
        const authErrorSignupDiv = document.getElementById('auth-error-signup');

        showSignupBtn.addEventListener('click', () => {
            loginForm.classList.add('hidden');
            signupForm.classList.remove('hidden');
        });

        showLoginBtn.addEventListener('click', () => {
            signupForm.classList.add('hidden');
            loginForm.classList.remove('hidden');
        });

        loginBtn.addEventListener('click', async () => {
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            const { error } = await supabase.auth.signInWithPassword({ email, password });
            if (error) authErrorDiv.textContent = error.message;
            else authErrorDiv.textContent = '';
        });

        signupBtn.addEventListener('click', async () => {
            const email = document.getElementById('signup-email').value;
            const password = document.getElementById('signup-password').value;
            const fullName = document.getElementById('signup-fullname').value;
            const { error } = await supabase.auth.signUp({
                email,
                password,
                options: {
                    data: {
                        full_name: fullName,
                        avatar_url: `https://api.dicebear.com/8.x/initials/svg?seed=${fullName}` // Default avatar
                    }
                }
            });
            if (error) authErrorSignupDiv.textContent = error.message;
            else authErrorSignupDiv.textContent = 'Check your email for a confirmation link!';
        });

        logoutBtn.addEventListener('click', async () => {
            await supabase.auth.signOut();
        });

        // Listen for auth state changes
        supabase.auth.onAuthStateChange(async (event, session) => {
            if (session) {
                currentUser = session.user;
                await loadUserProfile();
                authContainer.classList.add('hidden');
                appContainer.classList.remove('hidden');
                await loadChatHistory();
                listenToChatHistory();
            } else {
                currentUser = null;
                userProfile = null;
                authContainer.classList.remove('hidden');
                appContainer.classList.add('hidden');
                if (chatHistorySubscription) {
                    chatHistorySubscription.unsubscribe();
                    chatHistorySubscription = null;
                }
            }
        });
        
        // --- PROFILE MANAGEMENT ---
        const updateProfileBtn = document.getElementById('update-profile-btn');
        const profileMessageDiv = document.getElementById('profile-message');

        async function loadUserProfile() {
            if (!currentUser) return;
            const { data, error } = await supabase
                .from('profiles')
                .select('*')
                .eq('id', currentUser.id)
                .single();
            
            if (data) {
                userProfile = data;
                document.getElementById('profile-username').value = userProfile.username || '';
                document.getElementById('profile-fullname').value = userProfile.full_name || '';
                document.getElementById('profile-website').value = userProfile.website || '';
                document.getElementById('profile-avatar').value = userProfile.avatar_url || '';
            } else if (error && error.message !== 'JSON object requested, multiple (or no) rows returned') {
                console.error('Error loading profile:', error.message);
            }
        }
        
        updateProfileBtn.addEventListener('click', async () => {
            if (!currentUser) return;
            const updates = {
                id: currentUser.id,
                username: document.getElementById('profile-username').value,
                full_name: document.getElementById('profile-fullname').value,
                website: document.getElementById('profile-website').value,
                avatar_url: document.getElementById('profile-avatar').value,
                updated_at: new Date(),
            };
            
            const { error } = await supabase.from('profiles').upsert(updates);
            
            if (error) {
                profileMessageDiv.textContent = `Error: ${error.message}`;
                profileMessageDiv.classList.remove('text-green-400');
                profileMessageDiv.classList.add('text-red-400');
            } else {
                profileMessageDiv.textContent = 'Profile updated successfully!';
                profileMessageDiv.classList.add('text-green-400');
                profileMessageDiv.classList.remove('text-red-400');
                await loadUserProfile(); // Reload profile data
            }
        });


        // --- CHAT LOGIC ---
        const chatInput = document.getElementById('chat-input'), sendBtn = document.getElementById('send-btn'), chatHistoryEl = document.getElementById('chat-history');

        async function loadChatHistory() {
            if (!currentUser) return;
            chatHistoryEl.innerHTML = ''; // Clear existing messages
            const { data, error } = await supabase
                .from('chat_history')
                .select('*')
                .eq('user_id', currentUser.id)
                .order('created_at', { ascending: true });

            if (error) {
                console.error("Error loading chat history:", error.message);
                return;
            }
            data.forEach(msg => appendMessage(msg.content, msg.sender, false));
        }
        
        function listenToChatHistory() {
            if (chatHistorySubscription) return; // Don't subscribe twice
            chatHistorySubscription = supabase
                .channel('public:chat_history')
                .on('postgres_changes', { event: 'INSERT', schema: 'public', table: 'chat_history', filter: `user_id=eq.${currentUser.id}` }, payload => {
                    // This is commented out to prevent duplicating messages added optimistically.
                    // If you need real-time updates from other clients, you'd handle this differently.
                    // console.log('New message received!', payload.new);
                    // appendMessage(payload.new.content, payload.new.sender, false);
                })
                .subscribe();
        }

        async function handleChat() {
            const prompt = chatInput.value.trim();
            if (!prompt || !currentUser) return;
            chatInput.value = '';

            // Add user message to UI and DB
            appendMessage(prompt, 'user', true);
            const typingIndicator = appendMessage('<div class="typing-indicator"><span></span><span></span><span></span></div>', 'ai', false);

            try {
                // Call Supabase Edge Function for AI response
                const { data, error } = await supabase.functions.invoke('text-generation', {
                    body: { prompt },
                });

                if (error) throw error;
                
                const aiResponse = data.response;
                typingIndicator.querySelector('p').innerHTML = aiResponse.replace(/\n/g, '<br>').replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
                
                // Add AI response to DB
                await supabase.from('chat_history').insert({
                    user_id: currentUser.id,
                    sender: 'ai',
                    content: aiResponse
                });

            } catch (error) {
                console.error('Error calling text-generation function:', error.message);
                typingIndicator.querySelector('p').textContent = 'Sorry, I encountered an error.';
            }
        }
        
        chatInput.addEventListener('keypress', (e) => { if (e.key === 'Enter') handleChat(); });
        sendBtn.addEventListener('click', () => handleChat());

        async function appendMessage(text, sender, saveToDb = false) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `chat-message ${sender === 'user' ? 'user-message' : 'ai-message'}`;
            
            const avatar = document.createElement('div');
            avatar.className = `avatar ${sender === 'user' ? 'user-avatar' : 'ai-avatar'}`;
            if (sender === 'user' && userProfile?.avatar_url) {
                 avatar.style.backgroundImage = `url('${userProfile.avatar_url}')`;
                 avatar.textContent = '';
            } else if (sender === 'user') {
                avatar.textContent = 'You';
            } else {
                avatar.textContent = 'A';
            }

            const messageText = document.createElement('p');
            messageText.innerHTML = text.replace(/\n/g, '<br>').replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
            
            messageDiv.append(avatar, messageText);
            chatHistoryEl.appendChild(messageDiv);
            chatHistoryEl.scrollTop = chatHistoryEl.scrollHeight;

            if (saveToDb && currentUser) {
                const { error } = await supabase.from('chat_history').insert({
                    user_id: currentUser.id,
                    sender: sender,
                    content: text
                });
                if (error) console.error("Error saving message:", error.message);
            }
            return messageDiv;
        }
        
        // --- SECURE API CALLS VIA SUPABASE EDGE FUNCTIONS ---
        async function generateTextResponse(prompt) {
            try {
                const { data, error } = await supabase.functions.invoke('text-generation', {
                    body: { prompt },
                });
                if (error) throw error;
                return data.response;
            } catch (error) {
                console.error('Error invoking text-generation function:', error);
                return "Sorry, I couldn't get a response.";
            }
        }

        async function generateImage() {
            const imagePrompt = document.getElementById('image-prompt');
            const imageGallery = document.getElementById('image-gallery');
            const imageLoading = document.getElementById('image-loading');
            const prompt = imagePrompt.value.trim();
            if (!prompt) return;

            imageGallery.innerHTML = '';
            imageLoading.classList.remove('hidden');

            try {
                const { data, error } = await supabase.functions.invoke('image-generation', {
                    body: { prompt },
                });
                if (error) throw error;
                
                if (data.imageUrl) {
                    const galleryItem = document.createElement('div');
                    galleryItem.className = 'gallery-item';
                    const img = document.createElement('img');
                    img.src = data.imageUrl;
                    const overlay = document.createElement('div');
                    overlay.className = 'gallery-item-overlay';
                    const downloadLink = document.createElement('a');
                    downloadLink.href = data.imageUrl;
                    downloadLink.download = `${prompt.substring(0, 20)}.png`;
                    downloadLink.className = 'action-btn';
                    downloadLink.innerHTML = '<i class="fas fa-download"></i> Download';
                    overlay.appendChild(downloadLink);
                    galleryItem.append(img, overlay);
                    imageGallery.appendChild(galleryItem);
                } else {
                     throw new Error(data.error || "Invalid response from image generation function.");
                }

            } catch (error) {
                 console.error("Image Generation Fetch Error:", error);
                 imageGallery.innerHTML = `<p class="text-red-400 col-span-full text-center">${error.message}</p>`;
            } finally {
                imageLoading.classList.add('hidden');
            }
        }
        document.getElementById('generate-image-btn').addEventListener('click', generateImage);


        // --- ALL OTHER FEATURE LOGIC (mostly unchanged, but using secure API calls) ---
        // This is a placeholder for all the other event listeners and functions from the original file.
        // They need to be adapted to use `generateTextResponse()` instead of the old insecure functions.
        // Example for one button:
        document.getElementById('solve-math-btn').addEventListener('click', async () => { 
            const prompt = document.getElementById('math-prompt').value; 
            const resultBox = document.getElementById('math-result'); 
            resultBox.innerHTML = '<div class="typing-indicator"><span></span><span></span><span></span></div>'; 
            const response = await generateTextResponse(`Solve this math problem: ${prompt}`);
            resultBox.textContent = response;
            resultBox.closest('.feature-panel').querySelector('.download-btn').classList.remove('hidden'); 
        });
        
        // --- Feature Switching (Unchanged) ---
        const menuItems = document.querySelectorAll('.menu-item'), featureContents = document.querySelectorAll('.feature-content');
        let workplaceEditorInstance = null;
        menuItems.forEach(item => {
            item.addEventListener('click', () => {
                const feature = item.getAttribute('data-feature');
                if (!feature || item.id === 'logout-menu-item') return;
                menuItems.forEach(i => i.classList.remove('active'));
                item.classList.add('active');
                featureContents.forEach(content => content.classList.add('hidden'));
                const contentToShow = document.getElementById(`${feature}-feature`);
                if (contentToShow) contentToShow.classList.remove('hidden');
                if (feature === 'code' && !workplaceEditorInstance) {
                    initializeMonacoEditor();
                }
                 if (feature === 'settings') {
                    loadUserProfile();
                }
            });
        });
        
        // --- All other functions and event listeners from the original file go here ---
        // Make sure to replace any direct API calls with calls to the new secure functions
        // like `generateTextResponse` and `generateImage`.
        
        // Example of adapting another feature
        document.getElementById('research-btn').addEventListener('click', async () => { 
            const prompt = document.getElementById('research-prompt').value; 
            const resultBox = document.getElementById('research-result'); 
            resultBox.innerHTML = '<div class="typing-indicator"><span></span><span></span><span></span></div>'; 
            const response = await generateTextResponse(`Search Google for "${prompt}" and provide a detailed summary of the top results.`);
            resultBox.textContent = response;
            resultBox.closest('.feature-panel').querySelector('.download-btn').classList.remove('hidden'); 
        });
        
        // --- Monaco Editor (Unchanged) ---
        function initializeMonacoEditor() {
            // This function remains the same
        }
    </script>
    <!-- 
    ==================================================================
    SUPABASE EDGE FUNCTIONS
    
    You must deploy the following code as Edge Functions in your Supabase project.
    Go to your Supabase Dashboard -> Edge Functions -> Create a new function.
    
    1. Create a function named 'text-generation'.
    2. Create a function named 'image-generation'.
    
    For each function, copy the corresponding code below.
    
    IMPORTANT: You also need to set your API keys as environment variables in Supabase.
    Go to Settings -> Edge Functions -> Add new environment variable.
    Create variables like:
    - GEMINI_API_KEY
    - DEEPSEEK_API_KEY
    - GROK_API_KEY
    ==================================================================
    -->

    <!-- 
    CODE FOR: /supabase/functions/text-generation/index.ts
    
    import { serve } from "https://deno.land/std@0.168.0/http/server.ts";
    import { corsHeaders } from "../_shared/cors.ts";

    // API Keys from environment variables
    const GEMINI_API_KEY = Deno.env.get("GEMINI_API_KEY");
    const DEEPSEEK_API_KEY = Deno.env.get("DEEPSEEK_API_KEY");
    const GROK_API_KEY = Deno.env.get("GROK_API_KEY");

    async function callGemini(prompt: string) {
        if (!GEMINI_API_KEY) throw new Error("GEMINI_API_KEY is not set.");
        const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash-latest:generateContent?key=${GEMINI_API_KEY}`;
        const res = await fetch(url, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] }),
        });
        if (!res.ok) throw new Error(`Gemini API error: ${await res.text()}`);
        const data = await res.json();
        return data.candidates[0]?.content?.parts[0]?.text;
    }

    async function callDeepSeek(prompt: string) {
        if (!DEEPSEEK_API_KEY) throw new Error("DEEPSEEK_API_KEY is not set.");
        const url = `https://api.deepseek.com/chat/completions`;
        const res = await fetch(url, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${DEEPSEEK_API_KEY}` },
            body: JSON.stringify({ model: "deepseek-chat", messages: [{ "role": "user", "content": prompt }] }),
        });
        if (!res.ok) throw new Error(`DeepSeek API error: ${await res.text()}`);
        const data = await res.json();
        return data.choices[0]?.message?.content;
    }
    
    async function callGrok(prompt: string) {
        if (!GROK_API_KEY) throw new Error("GROK_API_KEY is not set.");
        const url = 'https://api.groq.com/openai/v1/chat/completions';
        const res = await fetch(url, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${GROK_API_KEY}` },
            body: JSON.stringify({ model: "gemma-7b-it", messages: [{ "role": "user", "content": prompt }] }),
        });
        if (!res.ok) throw new Error(`Grok API error: ${await res.text()}`);
        const data = await res.json();
        return data.choices[0]?.message?.content;
    }


    serve(async (req) => {
        if (req.method === 'OPTIONS') {
            return new Response('ok', { headers: corsHeaders });
        }

        try {
            const { prompt } = await req.json();
            let responseText;

            try {
                console.log("Attempting Gemini...");
                responseText = await callGemini(prompt);
            } catch (e1) {
                console.error("Gemini failed:", e1.message);
                try {
                    console.log("Falling back to DeepSeek...");
                    responseText = await callDeepSeek(prompt);
                } catch (e2) {
                    console.error("DeepSeek failed:", e2.message);
                     try {
                        console.log("Falling back to Grok...");
                        responseText = await callGrok(prompt);
                    } catch (e3) {
                       console.error("Grok failed:", e3.message);
                       throw new Error("All text models failed.");
                    }
                }
            }
            
            if (!responseText) {
                throw new Error("No response from any AI model.");
            }

            return new Response(JSON.stringify({ response: responseText }), {
                headers: { ...corsHeaders, "Content-Type": "application/json" },
                status: 200,
            });
        } catch (error) {
            return new Response(JSON.stringify({ error: error.message }), {
                headers: { ...corsHeaders, "Content-Type": "application/json" },
                status: 500,
            });
        }
    });
    -->
    
    <!-- 
    CODE FOR: /supabase/functions/image-generation/index.ts
    
    import { serve } from "https://deno.land/std@0.168.0/http/server.ts";
    import { corsHeaders } from "../_shared/cors.ts";

    const IMAGEN_API_KEY = Deno.env.get("IMAGEN_API_KEY"); // You need to set this in Supabase env variables

    serve(async (req) => {
        if (req.method === 'OPTIONS') {
            return new Response('ok', { headers: corsHeaders });
        }

        try {
            if (!IMAGEN_API_KEY) {
                throw new Error("IMAGEN_API_KEY environment variable not set.");
            }
            const { prompt } = await req.json();
            
            const payload = { instances: [{ prompt: prompt }], parameters: { "sampleCount": 1 } };
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/imagen-3.0-generate-002:predict?key=${IMAGEN_API_KEY}`;

            const response = await fetch(apiUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });

            if (!response.ok) {
                const errorBody = await response.text();
                throw new Error(`Image Generation API failed: ${errorBody}`);
            }

            const result = await response.json();

            if (result.predictions && result.predictions[0]?.bytesBase64Encoded) {
                const imageUrl = `data:image/png;base64,${result.predictions[0].bytesBase64Encoded}`;
                return new Response(JSON.stringify({ imageUrl: imageUrl }), {
                    headers: { ...corsHeaders, "Content-Type": "application/json" },
                    status: 200,
                });
            } else {
                throw new Error("Invalid response structure from image API.");
            }

        } catch (error) {
            return new Response(JSON.stringify({ error: error.message }), {
                headers: { ...corsHeaders, "Content-Type": "application/json" },
                status: 500,
            });
        }
    });
    -->
</body>
</html>
